---
layout: single
title : "[통계] 다중검정, 1종오류를 줄이는 방법 , 검정력(power)이란"
author_profile: true
read_time: false
comments: true
categories:
- Statistics
published : false
---

<br>
<br>



(아래 내용은 유튜브 StatQuest 강의를 바탕으로 공부하면서 정리한 내용입니다. 공부하면서 추가적으로 검색을통해 알게된 내용들도 추가했습니다.)



## 1. 다중검정

⇒ 여러개의 가설검정을 동시에 수행하는것

예를들어, 폐암과 연관성이 있는 요인들을 찾기 위해서 폐암 환자와 정상인의 나이, 체질량 지수, 식습관, 음주습관, 운동량 등 10,000 가지의 요인을 유의수준 0.05하에서 비교한다고 해보자.

그럼 이때 각각의 요인에 대해서 false positive일 가능성이 5%인데, 이것이 10,000개이므로 500개의 가설에 대해 잘못된 기각을 하게될 수 있다.

이를 방지하기 위해 **본페로니(bonferonni) 보정 방법, Multi-step 보정 방법, FDR( False Discovery Rate )** 등이 있다.

아래에서는 자세한 보정 방법 보다는 간단하게 이를 예방할 수 있는 방법을 소개한다.





<br>



## 2-1. P-hacking 이란
[p-hacking 강의 링크](https://www.youtube.com/watch?v=HDCOUXE3HMM)

> 분석기술을 오용, 남용하는것을 의미하며 거짓양성(false-positive)에 속는 결과를 초래한다. (거짓양성 : 귀무가설이 참인데 기각할 확률 )

1. 다중검정을 할 경우, 좋아보이는 데이터만 p-value 검정을 해서 귀무가설을 기각하는것 (p-value<0.05 일것 같은 데이터만)
2. 검정 중 0.05보단 크지만 거의 근접한 p-value를 얻었을 때, 이미 있는 데이터에 추가로 관찰값을 추가하는것
   1. 위를 방지하기위한 방법 ⇒ 실험 전 적절한 표본크기를 결정한다.
      1. 실험전에 적절한 표본의 크기를 결정해서 중간에 데이터를 추가해서 반복해서 검정하는 일은 없도록 해야한다. 이때 적절한 표본의 크기를 구하려면 `[‘검정력 분석']` 을 해야한다.

<br>



## 2-2. 1종오류 (false positive)를 줄이는 방법

1. **Bonferroni**
   1. 유의수준을 검정하려는 횟수로 나누어 개별 검정의 유의수준으로 정하는것이다.
      1. ex) 5000번의 T-test를 한다면, 각각의 T-test 유의수준을 0.05/5000=0.00001로 하는것.
   2. 단점은, 너무 보수적이여서 비교의 개수가 커지면 유의수준이 너무 작아져 검정력이 떨어진다.

2. **FDR (False Discovery Rate)**
   > FDR = false positive / total positive (total positive = false positive + true positive)

- Step1. 유의하다고 판단한 것 중에 틀릴 확률을 고정시키는 조정된 p-value를 정의한다. (위 값을 계산)
- Step2. 개별 연구의 p-value를 작은 순서대로 나열한다.
- Step3. 개별 p-value가 조정된 기각역(alpha)보다 작은경우까지만 기각한다.

![png](/images/2022-02-14-statistics-FalsePositive-Power_files/2022-02-14-statistics-FalsePositive-Power_1.png)
  



<br>

### Summary

- 여러 약들이 어떤 바이러스로부터 회복하는데 도움을 주는가? 처럼 검정하길 원하는 것들이 많이 있다면(다중검정) 달라보이는 것들에 대해서만 p-value를 계산하지말고
- 그대신, 각 테스트마다 p-value를 계산하고 모든 p-value를 False Discovery Rate와 같은 방법으로 조정한다.
- 그리고 검정 중 0.05보단 크지만 근접한 값을 얻을경우, 이미 있는 데이터에 추가적으로 관찰값을 추가하지말고
- 검정력 분석이 알맞은 표본의 크기를 결정할 수 있도록 데이터를 사용한다. 



<br>






## 3. 검정력(Power)이란
[Power 강의 링크](https://www.youtube.com/watch?v=Rsc5znwR5FA)

> Power(검정력) 은 귀무가설을 올바르게 기각할 확률이다. 다른말로 하면, **검정력이란 '올바르게 작은 값의 p-value(0.05) 를 얻을 확률'** 이라고 할 수 있다.

<br>

![png](/images/2022-02-14-statistics-FalsePositive-Power_files/2022-02-14-statistics-FalsePositive-Power_2.png)
- 위 그림처럼 겹치는 부분이 매우 적은 두 분포가 있을 때는 아주 좋은 검정력을 가진다. 왜냐하면 귀무가설을 올바르게 기각할 확률이 높기 때문이다.

<br>


![png](/images/2022-02-14-statistics-FalsePositive-Power_files/2022-02-14-statistics-FalsePositive-Power_3.png)
- 그러나, 위 그림처럼 두 분포가 많이 겹쳐있고, 작은 표본크기를 갖는다면, 낮은 검정력을 가질 것이다.
  - 쉽게말하면 ⇒ 두 분포가 명확히 떨어져있지 않으니까, 서로 다른 분포로부터 나온 값이라고 말하기가 더 어려워짐.
- 검정력을 높이기 위해서는, 표본의 크기를 키우면됨.
  - 쉽게말하면 ⇒ 더 여러번 뽑다보면, 언젠가는 두개가 서로 다른 분포에서 나온 값이라는것이 발견될 확률이 높아지니까



<br>



## 4. 검정력 분석이란
[Power Analysis 강의 링크](https://www.youtube.com/watch?v=VX_M3tIyiYk)


```
좋은 검정력을 갖기 위해서 얼마나 많은 측정을 해야하는지. 
즉, 각각의 샘플이 얼마나 있어야 하는지 말해준다.

검정력 분석은 실험 전에 수행되며, 
귀무가설을 높은 확률로 올바르게 기각하기위해 얼마나 많은 모사(replicates)가 필요한지 말해준다.
```



<br>

### 4-1. **검정력이 영향을 받는 2가지**

1. 우리가 식별하기 원하는 두 분포 사이가 얼마나 많이 겹쳐있는가
2. 표본크기 : 각 그룹에서 몇개씩 측정값을 얻을 것인가

<br>


![png](/images/2022-02-14-statistics-FalsePositive-Power_files/2022-02-14-statistics-FalsePositive-Power_4.png)
- 모집단의 평균을 추정하기 위해 하나 이상의 측정값을 사용했을 때,
- 극한의 측정값들이 추정된 평균의 위치에 미치는 영향이 적기 때문이다.

<br>

> **즉, 분포가 겹치더라도 표본의 크기가 크다면 높은 검정력을 가질 수 있다.**



<br>

### 4-2. 검정력 분석 하는 방법

1. 얼마만큼의 `검정력`을 원하는가 를 알아야한다. (일반적으로 0.8)
   1. 검정력 0.8의미는, 80%의 확률로 ‘올바르게 귀무가설을 기각한다' 를 의미한다.
2. 유의수준의 `임계값(alpha)`을 정해야한다. (일반적으로 0.05)
3. 두 분포가 얼마나 겹쳐있는지 추정해야한다.
   1. 두 모집단 평균 사이의 거리와 표준편차에 영향을 받는다.
   2. 평균의 차이와 표준편차를 하나의 지표로 합치는 방법은 `효과크기`를 계산하는것 ‘d’라고도 부름.
      1. Effect size(d) = (추정된 평균값의 차이) / (합동 추정 표준편차)
         1. 합동 추정 표준편차 = 루트((s1^+s2^)/2)
4. Effect Size(효과크기), Power(검정력), 유의수준(alpha)을 알면  ‘검정통계량 계산기' 를 통해 `Sample size`를 계산할 수 있다.
   1. Sample size=9의 의미는, 각 그룹당 9개의 측정값을 얻는다면 80%의 확률로 올바르게 귀무가설을 기각할 수 있다는 뜻.



<br>

